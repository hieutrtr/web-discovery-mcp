# Story 2.5: Page Analysis Data Collection

## Status
Approved

## Story
**As a** developer,
**I want** structured data collection from each analyzed page,
**so that** the LLM analysis pipeline has comprehensive input for generating insights.

## Acceptance Criteria
1. DOM structure analysis with element counts, form fields, and interactive components
2. Page functionality categorization (forms, navigation, content display, user interactions)
3. Accessibility tree extraction for understanding page structure and user flows
4. JavaScript detection and framework identification (React, Angular, Vue, jQuery)
5. CSS analysis for styling patterns and responsive design detection
6. Performance metrics collection (load times, resource usage, rendering performance)
7. Structured data output in JSON format optimized for LLM processing and human review

## Tasks / Subtasks
- [ ] Analyze DOM structure and element counts (AC: 1)
  - [ ] Extract forms, inputs, buttons, interactive components with metadata (AC: 1)
- [ ] Categorize page functionality (AC: 2)
  - [ ] Apply heuristics to label page type and key workflows (AC: 2)
- [ ] Capture accessibility tree (AC: 3)
  - [ ] Use Playwright accessibility API to export semantic structure (AC: 3)
- [ ] Detect JavaScript frameworks (AC: 4)
  - [ ] Inspect window globals, script tags, or HTML attributes for framework signatures (AC: 4)
- [ ] Perform CSS analysis (AC: 5)
  - [ ] Identify linked stylesheets, responsive breakpoints, critical classes (AC: 5)
- [ ] Record performance metrics (AC: 6)
  - [ ] Collect navigation timing, resource sizes, and rendering benchmarks (AC: 6)
- [ ] Serialize page analysis output (AC: 7)
  - [ ] Generate JSON aligned with architecture Page model for LLM pipeline (AC: 7)

## Dev Notes
- Merge artifacts from `docs/stories/2.2.page-navigation-and-content-extraction.md` and `docs/stories/2.3.network-traffic-monitoring.md` into a single per-page record.
- Match the JSON schema to the Page entity defined in `docs/architecture.md#page` for Epic 3 ingestion (`docs/prd.md#epic-3-llm-integration--two-step-analysis-pipeline`).
- Use dataclasses/pydantic per the guidance in `docs/architecture.md#tech-stack` to keep structures typed.
- Optimize processing to stay within the <2 minute per-page target from `docs/prd.md#non-functional-requirements`.
- Capture summary counts using the structured logging approach in `docs/architecture.md#architectural-and-design-patterns`.

### Testing
- Unit tests for each analyzer component using fixture HTML/CSS/JS files to validate detection logic.
- Integration tests running end-to-end analysis on sample pages verifying combined JSON output.
- Performance regression test ensuring data collection stays within expected timeframe using pytest markers.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-02-14 | 0.1 | Initial draft | John (PM) |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

Gate: PASS â†’ docs/qa/gates/2.5-page-analysis-data-collection.yml
