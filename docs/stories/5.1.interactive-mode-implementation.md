# Story 5.1: Interactive Mode Implementation

## Status
Approved

## Story
**As a** user,
**I want** human-in-the-loop validation during analysis,
**so that** I can guide the analysis process, validate findings, and ensure accuracy for critical legacy applications

## Acceptance Criteria
1. MCP prompt `interactive_analysis` presents decision points with clear options during analysis workflow
2. User confirmation required before proceeding to LLM analysis for each page with cost estimates
3. Step 1 results review interface allowing user to approve, modify, or retry content summarization
4. Step 2 validation checkpoints where user can verify feature analysis accuracy before proceeding
5. Page selection refinement allowing users to skip, prioritize, or add pages based on initial discoveries
6. Analysis parameter adjustment (model selection, timeout values) during interactive sessions
7. Graceful pause/resume capability with state preservation at any interaction point

## Tasks / Subtasks
- [ ] Create `interactive_analysis` flow orchestrating per-page prompts with user choices (AC: 1)
- [ ] Display model cost estimates using data from Stories 3.1-3.2 before running Step 1 (AC: 2)
- [ ] Render Step 1 summary for approval/edit/retry and persist user decisions (AC: 3)
- [ ] Provide Step 2 validation checkpoint with accept/retry controls (AC: 4)
- [ ] Allow users to adjust page queue ordering or skip/add URLs mid-session (AC: 5)
- [ ] Surface runtime configuration tweaks (model, timeout) applied dynamically (AC: 6)
- [ ] Integrate with checkpoint system to save state on every decision (AC: 7)

## Dev Notes
- Implement workflow as described in `docs/prd.md#story-51-interactive-mode-implementation`.
- Leverage progress/queue structures from `docs/stories/4.1.real-time-progress-tracking-system.md` and `docs/stories/2.6.sequential-navigation-workflow.md`.
- Cost estimates should use budget tracking metrics from `docs/stories/3.2.configuration-based-model-selection.md`.
- Ensure user edits feed back into ContentSummary/FeatureAnalysis models defined in `docs/architecture.md#contentsummary` and `docs/architecture.md#featureanalysis`.
- Persist user decisions via checkpointing per `docs/stories/4.2.checkpoint-and-resume-functionality.md`.

### Testing
- Unit test decision flow handling approvals, retries, and parameter updates.
- Integration test interactive loop with mocked user responses to ensure correct branching.
- Regression test checkpoint persistence across interactive pauses/resumes.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-02-14 | 0.1 | Initial draft | John (PM) |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

Gate: PASS â†’ docs/qa/gates/5.1-interactive-mode-implementation.yml
