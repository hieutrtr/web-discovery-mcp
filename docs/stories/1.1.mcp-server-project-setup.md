# Story 1.1: MCP Server Project Setup

## Status
Ready for Done

## Story
**As a** developer,
**I want** to initialize a new MCP server project with proper Python 3.11 structure and FastMCP framework,
**so that** I have a solid foundation for building the legacy web analysis tool.

## Acceptance Criteria
1. Python 3.11 project structure created with proper package organization
2. FastMCP framework integrated and basic MCP server responds to ping requests
3. Development environment setup with linting, formatting, and basic testing framework
4. Git repository initialized with appropriate .gitignore and README
5. Basic CI/CD pipeline configured for automated testing
6. Environment variable template created for configuration management

## Tasks / Subtasks
- [x] Scaffold Python 3.11 project structure (AC: 1)
  - [x] Create source package layout following modular monolith organization (AC: 1)
  - [x] Configure `pyproject.toml` with project metadata and dependencies (AC: 1)
- [x] Integrate FastMCP framework and ping handler (AC: 2)
  - [x] Install FastMCP 2.12.0 and wire basic server entrypoint (AC: 2)
  - [x] Implement `ping` tool/resource responding successfully (AC: 2)
- [x] Configure development tooling (AC: 3)
  - [x] Add ruff formatting/linting and mypy type checking configuration (AC: 3)
  - [x] Configure pytest + pytest-asyncio with initial placeholder test (AC: 3)
- [x] Initialize repository assets (AC: 4)
  - [x] Add `.gitignore` aligned with Python, Playwright, MCP artifacts (AC: 4)
  - [x] Draft README with project overview and setup instructions (AC: 4)
- [x] Set up CI/CD pipeline (AC: 5)
  - [x] Create GitHub Actions workflow running lint, type check, and tests (AC: 5)
- [x] Provide environment variable template (AC: 6)
  - [x] Add `.env.template` covering LLM keys and configuration (AC: 6)

## Dev Notes
- Use Python 3.11 with AsyncIO-ready project layout per `docs/architecture.md#high-level-architecture` and the modular monolith guidance.
- Adopt FastMCP protocol handler as entrypoint with tool/resource registration aligned to the diagrams in `docs/architecture.md#high-level-project-diagram`.
- Align dependency versions with the tech stack table (`docs/architecture.md#tech-stack`) even if initial implementations are stubs.
- Configure structlog-based logging and async readiness following `docs/architecture.md#architectural-and-design-patterns`.
- Document uv/uvx workflow details from `docs/architecture.md#deployment--distribution` in the README for local execution parity.

### Testing
- Place unit tests in `tests/unit/` mirroring package modules; integration tests not required yet but keep structure ready.
- Use pytest with pytest-asyncio; follow AAA structure and mock external dependencies.
- Ensure GitHub Actions workflow runs lint (`ruff`), type checks (`mypy`), and tests (`pytest`).

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-02-14 | 0.1 | Initial draft | John (PM) |
| 2025-09-18 | 0.2 | QA remediation: updated CI mypy command and gitignore for egg-info artifacts | James (Dev) |
| 2025-09-18 | 0.3 | Added bootstrap regression tests covering tooling, env template, and CI workflow | James (Dev) |

## Dev Agent Record

### Agent Model Used

gpt-5-codex (Codex CLI)

### Debug Log References

- uv run ruff check
- uv run mypy src tests
- uv run pytest

### Completion Notes List

- Bootstrapped FastMCP stdio server with async ping tool and JSON logging.
- Established uv-managed project configuration with linting, typing, and pytest suites.
- Added CI workflow, README, and environment template to support future stories.
- Updated CI mypy invocation and gitignore per QA findings.
- Added regression tests for project scaffolding, CLI entrypoint, tooling configuration, and env template.

### File List

- pyproject.toml
- .gitignore
- .env.template
- README.md
- LICENSE
- .github/workflows/ci.yml
- src/legacy_web_mcp/__init__.py
- src/legacy_web_mcp/__main__.py
- src/legacy_web_mcp/cli.py
- src/legacy_web_mcp/mcp/__init__.py
- src/legacy_web_mcp/mcp/server.py
- src/legacy_web_mcp/shared/logging.py
- tests/unit/test_server.py
- docs/stories/1.1.mcp-server-project-setup.md
- (removed) src/legacy_web_mcp.egg-info/
- tests/unit/test_project_bootstrap.py


## QA Results

Gate: PASS â†’ docs/qa/gates/1.1-mcp-server-project-setup.yml

### Review Date: 2025-09-18

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
- Code structure aligns with modular bootstrap goals, but CI configuration currently fails: `.github/workflows/ci.yml:35` calls `uv run mypy` without targets, which exits with `Missing target module` (observed locally). AC5 therefore not met until the command is updated (e.g., `uv run mypy src tests`).
- `.gitignore:3` lacks an entry for `*.egg-info/`; after running `uv sync`, a `src/legacy_web_mcp.egg-info/` tree is generated and currently unignored, creating a high risk of committing build artifacts.

### Test Coverage Assessment
- Implemented tests: `tests/unit/test_server.py:8` covers `ping` payload contract; no verification of CLI entrypoint or FastMCP RPC wiring yet.
- Missing scenarios against plan: planned P0 unit test for package import and P1 integration/E2E checks (`1.1-UNIT-001`, `1.1-INT-001`, `1.1-INT-002`, `1.1-E2E-001`) are absent; coverage remains minimal.

### Requirements Traceability
| AC | Coverage | Notes |
| --- | --- | --- |
| 1 | Manual inspection only | No automated guard for package structure |
| 2 | `tests/unit/test_server.py` (ping) | Lacks integration/E2E validation of FastMCP wiring |
| 3 | Manual verification via local tool runs | Recommend scripted smoke (ruff/mypy/pytest) |
| 4 | Manual review of README/.gitignore | Add `*.egg-info/` ignore to prevent artifact commits |
| 5 | **Gap** | CI workflow fails because `uv run mypy` exits with error |
| 6 | Manual review of `.env.template` | Template present; consider unit guard |

### NFR & Testability Notes
- Maintainability impacted by failing CI job; prevents automated regression guard.
- Testability: add lightweight CLI smoke test to exercise `legacy_web_mcp.cli.main()` without spawning the server to improve confidence.

### Recommendations
- Fix CI step by passing explicit modules to mypy (`uv run mypy src tests`) and add regression for CLI entrypoint.
- Extend .gitignore to include `*.egg-info/` (and ensure generated directories are cleaned) before commit.
- Add automated check for `.env.template` keys to guard AC6 going forward.

### Gate Recommendation
- Status: **Changes Required** until CI workflow executes successfully and ignores cover build artifacts.


### Review Date: 2025-09-18

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
- CI workflow now uses `uv run mypy src tests` and passes locally. AC5 regression risk resolved.
- `.gitignore` ignores `*.egg-info/`; artifact directory removed from repo tree.

### Test Coverage Assessment
- Existing unit test still only exercises `ping`. Planned integration/E2E smoke tests remain outstanding but tracked for future improvements (non-blocking for this gate).

### Requirements Traceability
| AC | Coverage | Notes |
| --- | --- | --- |
| 1 | Manual inspection + gitignore update | Structural guard still manual but acceptable for bootstrap |
| 2 | `tests/unit/test_server.py` | Future work: integration smoke |
| 3 | Tooling commands verified in debug log | |
| 4 | `.gitignore` automated guard now in place | |
| 5 | GitHub Actions workflow updated; command runs clean locally | |
| 6 | `.env.template` still manual check | |

### NFR & Testability Notes
- Maintainability concern cleared: pipeline now enforces lint/type/test successfully.
- Recommend follow-up integration smoke tests when higher-level tooling arrives.

### Recommendations
- Proceed with QA sign-off; future stories should add integration/E2E smoke tests per test design matrix.

### Gate Recommendation
- Status: **Ready for Done**

