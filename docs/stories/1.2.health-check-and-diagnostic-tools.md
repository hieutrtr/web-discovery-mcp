# Story 1.2: Health Check and Diagnostic Tools

## Status
Approved

## Story
**As a** developer using the MCP server,
**I want** comprehensive health check and diagnostic capabilities,
**so that** I can quickly identify and resolve setup or configuration issues.

## Acceptance Criteria
1. MCP tool `health_check` returns server status, FastMCP state, and dependency availability
2. MCP tool `validate_dependencies` checks Playwright browser installation and reports missing components
3. MCP tool `test_llm_connectivity` validates API keys and connectivity for OpenAI, Anthropic, and Gemini
4. Resource `system_status` provides real-time information about memory usage and active sessions
5. Configuration validator ensures all required environment variables are present and valid
6. Error reporting includes specific remediation steps for common issues

## Tasks / Subtasks
- [ ] Implement `health_check` tool reporting server components (AC: 1)
  - [ ] Surface FastMCP status, tool registry readiness, and dependency heartbeat (AC: 1)
- [ ] Build `validate_dependencies` tool for Playwright checks (AC: 2)
  - [ ] Detect installed browsers and missing dependencies with actionable guidance (AC: 2)
- [ ] Create `test_llm_connectivity` tool (AC: 3)
  - [ ] Perform async calls to OpenAI, Anthropic, Gemini using configured keys and report outcomes (AC: 3)
  - [ ] Handle missing keys gracefully while logging remediation hints (AC: 3,6)
- [ ] Expose `system_status` resource (AC: 4)
  - [ ] Report memory, active sessions, browser contexts based on AsyncIO metrics (AC: 4)
- [ ] Add configuration validator executed at startup and on demand (AC: 5)
  - [ ] Verify mandatory environment variables and model settings with clear errors (AC: 5,6)
- [ ] Standardize error messages with remediation steps in each tool/resource (AC: 6)
  - [ ] Use structlog for structured diagnostics and ensure messages surface to MCP clients (AC: 6)

## Dev Notes
- Locate diagnostics in a dedicated module registered through FastMCP to maintain the modular monolith boundaries described in `docs/architecture.md#high-level-architecture`.
- Apply the configuration validation approach from `docs/architecture.md#security` and the pydantic-settings usage in `docs/architecture.md#tech-stack`.
- Use AsyncIO patterns from `docs/architecture.md#architectural-and-design-patterns` to run dependency checks without blocking the event loop.
- Emit structured logs via structlog as specified in `docs/architecture.md#tech-stack`, including contextual metadata for troubleshooting.
- Keep tool/resource responses developer-friendly per the UX expectations in `docs/prd.md#story-12-health-check-and-diagnostic-tools`.

### Testing
- Unit test each diagnostic tool in `tests/unit/tools/test_health.py` style using pytest-asyncio and dependency mocks.
- Integration test via FastMCP client harness in `tests/integration/test_diagnostics.py` to validate JSON-RPC surface.
- Mock external LLM APIs using pytest-httpx to avoid live calls; include failure paths.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-02-14 | 0.1 | Initial draft | John (PM) |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

Gate: PASS â†’ docs/qa/gates/1.2-health-check-and-diagnostic-tools.yml
