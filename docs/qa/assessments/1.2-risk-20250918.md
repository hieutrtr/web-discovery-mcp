# Risk Profile: Story 1.2 - Health Check and Diagnostic Tools

## Summary Score

- Base Score: 100
- Critical Risks: 1 (−20)
- High Risks: 0
- Medium Risks: 1 (−5)
- Low Risks: 0

**Residual Score:** 75 (Requires remediation before release)

## Risk Matrix

| Risk ID   | Description                                                                 | Probability | Impact | Score | Priority |
|-----------|------------------------------------------------------------------------------|-------------|--------|-------|----------|
| TECH-001 | Env validator crashes when vars missing due to slots serialization bug       | High (3)    | High (3) | 9   | Critical |
| OPS-001  | External network probes can slow diagnostics under offline conditions        | Medium (2)  | Medium (2) | 4 | Medium   |

## Risk Register

### TECH-001 – Env validator serialization failure
- **Category:** Technical
- **Description:** `summarize_env_validation` uses `issue.__dict__`, but `EnvIssue` uses `slots=True`; missing env vars raise `AttributeError` causing health check/diagnostics to fail.
- **Affected Components:** `src/legacy_web_mcp/config/validator.py`, `src/legacy_web_mcp/mcp/diagnostics.py`
- **Probability:** High – many deployments start without keys configured.
- **Impact:** High – diagnostics become unusable, blocking AC5/AC6.
- **Mitigation:** Replace serialization with `dataclasses.asdict(issue)` or drop slots; add regression test for missing env scenario.
- **Status:** Needs fix prior to release.

### OPS-001 – Network probe latency/failures
- **Category:** Operational
- **Description:** LLM connectivity checks perform live HTTP requests; outages or firewall rules could delay tool responses.
- **Affected Components:** `_probe_llm_endpoint`, `test_llm_connectivity`
- **Probability:** Medium – external API instability is common.
- **Impact:** Medium – timeouts degrade diagnostics UX but do not crash server.
- **Mitigation:** Enforce shorter timeouts (already 5s) and log remediation; consider allowing configurable skip/offline mode; add monitoring for probe duration.
- **Status:** Acceptable with monitoring once TECH-001 resolved.

## Risk-Based Testing Strategy

1. **Critical:** Add unit test covering env-validation failure path; run after fix to protect AC5/AC6.
2. **Medium:** Introduce integration test simulating HTTP timeout to ensure graceful remediation messaging.

## Monitoring & Deployment Notes

- Ensure structlog messages for `configuration_missing_env` are surfaced in observability pipelines.
- Track duration and failure rate of LLM probes; alert if repeated timeouts occur.

---

Risk profile: docs/qa/assessments/1.2-risk-20250918.md
