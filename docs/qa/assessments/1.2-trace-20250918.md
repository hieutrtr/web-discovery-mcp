# Requirements Traceability Matrix

## Story: 1.2 - Health Check and Diagnostic Tools

### Coverage Summary

- Total Requirements: 6
- Fully Covered: 4 (67%)
- Partially Covered: 0 (0%)
- Not Covered: 2 (33%)

### Requirement Mappings

#### AC1: MCP tool `health_check` returns server status, FastMCP state, and dependency availability

- **Coverage:** FULL
- **Tests:**
  - `tests/unit/mcp/test_diagnostics.py::test_perform_health_check`
    - Given: FastMCP instance with diagnostic helper overrides
    - When: `perform_health_check` runs asynchronously
    - Then: Response includes server metadata, environment status, browser list, and LLM status entries
  - `tests/unit/test_server.py::test_create_mcp_registers_ping_tool`
    - Given: Server created via `create_mcp`
    - When: Listing registered tools
    - Then: `health_check` appears along with other diagnostics tools

#### AC2: MCP tool `validate_dependencies` checks Playwright installation and reports missing components

- **Coverage:** FULL
- **Tests:**
  - `tests/unit/mcp/test_diagnostics.py::test_gather_dependency_report`
    - Given: Stubbed Playwright checker returning missing Firefox
    - When: Gathering dependency report
    - Then: Response entry includes missing status and remediation guidance

#### AC3: MCP tool `test_llm_connectivity` validates API keys/connectivity for OpenAI, Anthropic, Gemini

- **Coverage:** FULL
- **Tests:**
  - `tests/unit/mcp/test_diagnostics.py::test_gather_llm_connectivity_handles_missing_keys`
    - Given: All LLM environment variables cleared
    - When: Gathering connectivity status
    - Then: Each provider reports `missing_key` with remediation instructions

#### AC4: Resource `system_status` provides real-time information about memory usage and active sessions

- **Coverage:** FULL
- **Tests:**
  - `tests/unit/test_server.py::test_create_mcp_registers_ping_tool`
    - Given: Registered MCP instance
    - When: Listing resource templates
    - Then: `/system/status/{scope}` template is available
  - `tests/unit/mcp/test_diagnostics.py::test_collect_system_status_snapshot`
    - Given: System status helper execution
    - When: Snapshot collected
    - Then: Payload includes timestamp and active task count

#### AC5: Configuration validator ensures required environment variables are present and valid

- **Coverage:** NONE
- **Gap:** `summarize_env_validation` crashes when env vars missing because `EnvIssue` uses `slots=True` but serializer accesses `issue.__dict__`. No automated test currently covers this failure path.

#### AC6: Error reporting includes specific remediation steps for common issues

- **Coverage:** NONE
- **Gap:** Same defect as AC5 prevents remediation payload from being returned when env vars are absent.

### Critical Gaps

1. **Env validation serialization bug**
   - Impact: Diagnostics fail when env vars missing; AC5/6 unmet
   - Action: Replace `issue.__dict__` with `dataclasses.asdict(issue)` (or remove slots) and add regression test

### Test Design Alignment

- P0 scenarios (env validation, browser checks, LLM probes) partially covered; missing-env branch still lacks enforcement
- Recommend adding test analogous to planned `1.2-UNIT-004` to assert remediation payload when env vars absent

### Trace Hook

Trace matrix: docs/qa/assessments/1.2-trace-20250918.md
